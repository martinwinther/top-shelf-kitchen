---
/**
 * RecipeCard - Glass card component for displaying recipe previews
 * 
 * Displays recipe title, description, badges, and meta information
 * Entire card is clickable and accessible
 */

import GlassCard from '../ui/GlassCard.astro';
import Badge from '../ui/Badge.astro';

type ImageData =
  | string
  | {
      src: string;
      alt?: string;
      width?: number;
      height?: number;
    }
  | undefined;

interface Props {
  title: string;
  description: string;
  href: string;
  category: string;
  cuisine: string;
  prepMinutes: number;
  cookMinutes: number;
  servingsDefault: number;
  image?: ImageData;
  imageAlt?: string;
}

const {
  title,
  description,
  href,
  category,
  cuisine,
  prepMinutes,
  cookMinutes,
  servingsDefault,
  image,
  imageAlt,
} = Astro.props;

const normalizeImage = (
  img: ImageData,
  fallbackAlt?: string
): { src: string; alt: string } | null => {
  if (!img) return null;
  if (typeof img === 'string') {
    return { src: img, alt: fallbackAlt || title };
  }
  return { src: img.src, alt: img.alt || fallbackAlt || title };
};

const normalizedImage = normalizeImage(image, imageAlt);

const totalMinutes = prepMinutes + cookMinutes;

const formatCategory = (cat: string): string => {
  return cat.charAt(0).toUpperCase() + cat.slice(1);
};
---

<a href={href} class="recipe-card-link">
  <GlassCard hover>
    {normalizedImage && (
      <div class="recipe-card-image">
        <img 
          src={normalizedImage.src} 
          alt={normalizedImage.alt}
          loading="lazy"
          decoding="async"
        />
      </div>
    )}
    <div class="recipe-card-content">
      <h3 class="recipe-card-title">{title}</h3>
      <p class="recipe-card-description">{description}</p>
      
      <div class="recipe-card-badges">
        <Badge tone="neutral">{formatCategory(category)}</Badge>
        <Badge tone="muted">{cuisine}</Badge>
      </div>
      
      <div class="recipe-card-meta">
        <span class="meta-item">
          <span class="meta-label">Prep</span>
          <span class="meta-value">{prepMinutes}m</span>
        </span>
        <span class="meta-item">
          <span class="meta-label">Cook</span>
          <span class="meta-value">{cookMinutes}m</span>
        </span>
        <span class="meta-item">
          <span class="meta-label">Total</span>
          <span class="meta-value">{totalMinutes}m</span>
        </span>
        <span class="meta-item">
          <span class="meta-label">Serves</span>
          <span class="meta-value">{servingsDefault}</span>
        </span>
      </div>
    </div>
  </GlassCard>
</a>

<style>
  .recipe-card-link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .recipe-card-image {
    margin: -1.5rem -1.5rem 1rem -1.5rem;
    overflow: hidden;
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
  }

  .recipe-card-image img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    display: block;
  }

  .recipe-card-content {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .recipe-card-title {
    font-size: 1.25rem;
    font-weight: 600;
    line-height: 1.3;
    margin: 0;
    color: var(--text);
  }

  .recipe-card-description {
    font-size: 0.9375rem;
    line-height: 1.5;
    color: var(--muted);
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .recipe-card-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .recipe-card-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    padding-top: 0.5rem;
    border-top: 1px solid var(--glass-border);
  }

  .meta-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .meta-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--muted);
  }

  .meta-value {
    font-size: 0.9375rem;
    font-weight: 500;
    color: var(--text);
  }

  @media (min-width: 768px) {
    .recipe-card-title {
      font-size: 1.375rem;
    }
  }
</style>




